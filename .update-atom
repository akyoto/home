#!/bin/bash
wget -q https://github.com/atom/atom/releases/latest -O /tmp/latest
MATCHEDROW=$(awk -F '[<>]' '/href=".*atom-amd64.deb/' /tmp/latest)
LATEST=$(echo $MATCHEDROW | grep -o -P '(?<=href=").*(?=" rel)')
VER_LATEST=$(echo $MATCHEDROW | rev | cut -d"/" -f 2 | rev | sed 's/v//g')
VER_INST=$(dpkg -l atom | tail -n1 | tr -s ' ' | cut -d" " -f 3)

if [ "$VER_LATEST" != "$VER_INST" ]; then
	wget --progress=bar -q "https://github.com/$LATEST" -O /tmp/atom-amd64.deb --show-progress
	sudo dpkg -i /tmp/atom-amd64.deb
	echo "Atom has been updated from $VER_LATEST to $VER_INST"
	logger -t atom-update "Atom has been updated from $VER_LATEST to $VER_INST"
else
	echo "Atom version $VER_INST is the latest version, no update required"
	logger -t atom-update "Atom version $VER_INST is the latest version, no update required"
fi